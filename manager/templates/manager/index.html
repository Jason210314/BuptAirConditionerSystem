<!--
 * @Author: your name
 * @Date: 2017-01-18 09:18:40
 * @LastEditTime: 2020-06-27 16:02:24
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /tx201701313/index.html
--> 
<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
        
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <style>
            .name{
                width: 600px;
            }
        </style>
        <script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
        
        <!-- Bootstrap Core CSS -->
        {% load static %}
        <link href="{% static 'css/bootstrap.css' %}" rel='stylesheet' type='text/css' />
    
        <!-- Custom CSS -->
        <link href="{% static 'css/style.css' %}" rel='stylesheet' type='text/css' />
        
        
         <!-- side nav css file -->
        
         <link href="{% static 'css/SidebarNav.min.css' %}" media='all' rel='stylesheet' type='text/css'/>
         <!-- side nav css file -->
        
         <!-- js-->
        
        <script src="{% static 'js/jquery-1.11.1.min.js' %}"></script>
        <script src="{% static 'js/modernizr.custom.js' %}"></script>
 
        <!-- Metis Menu -->
        
        <script src="{% static 'js/metisMenu.min.js' %}"></script>
        <link href="/static/css/foundation-datepicker.css" rel="stylesheet" type="text/css">
        
       
    </head>
	<body class="cbp-spmenu-push">
        <div class="main-content">
            <div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" id="cbp-spmenu-s1">
                <!--left-fixed -navigation-->
                <aside class="sidebar-left">
              <nav class="navbar navbar-inverse">
                  <div class="navbar-header">
                    <span class="sr-only">Toggle navigation</span>
                    </button>
                    <h1><a class="navbar-brand" href="#"><span class="fa fa-area-chart"></span>空调管理系统<span class="dashboard_text">Designed by 318D</span></a></h1>
                  </div>
                  <!-- /.navbar-collapse -->
              </nav>
            </aside>
            </div>
                <!--left-fixed -navigation-->
                <!-- header-starts -->
                <div class="sticky-header header-section ">
                    <div class="header-left">
                        <!--toggle button start-->
                        <button id="showLeftPush"><i class="fa fa-bars"></i></button>
                        <!--toggle button end-->
                        <!--notification menu end -->
                        <div class="clearfix"> </div>
                    </div>
                    <div class="header-right">
        
                        <div class="clearfix"> </div>
                    </div>
                    <div class="clearfix"> </div>
                </div>
                <!-- //header-ends -->
                <!-- main content start-->
                <div id="page-wrapper">
                    <span>
                        <form>
                        <table class="name">
                            <thead>
                                <br></br>
                                
                                <tr>&nbsp&nbsp
                                    <th>&nbsp&nbsp&nbsp&nbsp起始时间:
                                        <input type="text" class="span2" id="dpd1">
                                    </th>
                                   
                                </tr>
                                
                            </thead>
                            </table>
                        </form>
                        <br></br>
                        </span>
                    
                        <button type="button" id='rpt_day' class="btn btn-default"  style="float: right;">查询日报表</button></span>
                        <button type="button" id='rpt_week' class="btn btn-default"  style="float: right;">查询周报表</button></span>
                        <button type="button" id='rpt_month' class="btn btn-default"  style="float: right;">查询月报表</button></span>
                        <button type="button" id='rpt_year' class="btn btn-default"  style="float: right;">查询年报表</button></span>
                        <br></br>
                        <button type="button" id='print_day' onclick="saveCode('tb', '日报表')" class="btn btn-default"  style="float: right;">导出日报表</button></span>
                        <button type="button" id='print_week' onclick="saveCode('tb', '周报表')"class="btn btn-default"  style="float: right;">导出周报表</button></span>
                        <button type="button" id='print_month' onclick="saveCode('tb', '月报表')"class="btn btn-default"  style="float: right;">导出月报表</button></span>
                        <button type="button" id='print_year'onclick="saveCode('tb', '年报表')" class="btn btn-default"  style="float: right;">导出年报表</button></span>
                    
                <div class="-simple-chart-holder" style="margin:auto" >
                    <table id="tb" class="table table-hover" style="margin:auto">
                      <thead>
                        <tr>
                            <th scope="col">房间号</th>
                            <th scope="col">使用次数</th>
                            <th scope="col">最常用目标温度</th>
                            <th scope="col">最常用风速</th>
                            <th scope="col">达到目标温度次数</th>
                            <th scope="col">被调度次数</th>
                            <th scope="col">详单记录数</th>
                            <th scope="col">费用</th>
                        </tr>
                      </thead>
                      <tbody>
                          
                      </tbody>
        
                    </table>

                    
                   
                </div>
            </div>
                
            </div>


		<script src="/static/js/jquery-1.11.3.min.js"></script>
        <script src="/static/js/foundation-datepicker.js"></script>
        
		<script src="/static/js/locales/foundation-datepicker.zh-CN.js"></script>		
		<script>

		$('#demo-3').fdatepicker();
		var nowTemp = new Date();
		var checkin = $('#dpd1').fdatepicker(
		).on('changeDate', function (ev) {

			checkin.hide();
			
		}).data('datepicker');
		
        </script>

    <script src="{% static 'js/classie.js' %}"></script>
    <script>
        var menuLeft = document.getElementById( 'cbp-spmenu-s1' ),
            showLeftPush = document.getElementById( 'showLeftPush' ),
            body = document.body;

        showLeftPush.onclick = function() {
            classie.toggle( this, 'active' );
            classie.toggle( body, 'cbp-spmenu-push-toright' );
            classie.toggle( menuLeft, 'cbp-spmenu-open' );
            disableOther( 'showLeftPush' );
        };

        function disableOther( button ) {
            if( button !== 'showLeftPush' ) {
                classie.toggle( showLeftPush, 'disabled' );
            }
        }
    </script>
    <script>

$(document).ready(function() {
    $rpt_day_btn = $("#rpt_day");
    $rpt_week_btn = $("#rpt_week");
    $rpt_month_btn = $("#rpt_month");
    $rpt_year_btn = $("#rpt_year");

    $date_from= $("#dpd1");

    $rpt_day_btn.on("click", function() {
        date_from = $date_from.val();
        postgetrpt(date_from,'d')
    })
    $rpt_week_btn.on("click", function() {
        date_from = $date_from.val();
        postgetrpt(date_from,'w')
    })

    $rpt_month_btn.on("click", function() {
        date_from = $date_from.val();
        postgetrpt(date_from,'m')
    })

    $rpt_year_btn.on("click", function() {
        date_from = $date_from.val();
        postgetrpt(date_from,'y')
    })
})


function postgetrpt(date_from,r_type){
    console.log("查询报表");
    $.ajax({
        url: 'get_rpt',
        type: 'POST',
        dataType: 'JSON',
        data: {
            'date_from':date_from,
            'r_type':r_type
        },
        success: function (data) {
            console.log(data)
            var artTable = document.getElementById("tb");
            var artBody = artTable.tBodies[0];
            artBody.parentNode.outerHTML = artBody.parentNode.outerHTML.replace(artBody.innerHTML, "");
            var all_li = eval(data);
            var all_list = eval(all_li.data);
            var tb = document.getElementById('tb');
            var body = tb.querySelector('tbody');
            for (let i = 0; i < all_list.length; i++) {
                var fie = all_list[i].fields;
                var tr = document.createElement('tr');
                var tr2 = document.createElement('tr');
                var td1 = document.createElement('th', scope = "col");
                var td2 = document.createElement('td');
                var td3 = document.createElement('td');
                var td4 = document.createElement('td');
                var td5 = document.createElement('td');
                var td6 = document.createElement('td');
                var td7 = document.createElement('td');
                var td8 = document.createElement('td');
                
                td1.innerHTML = fie.room_id;
                td2.innerHTML = fie.oc_count;
                td3.innerHTML = fie.common_temp;
                td4.innerHTML = fie.common_spd;
                td5.innerHTML = fie.achieve_count;
                td6.innerHTML = fie.schedule_count ;
                td7.innerHTML = fie.ticket_count;
                td8.innerHTML = fie.total_cost.toFixed(2);

                tr.append(td1);
                tr.append(td2);
                tr.append(td3);
                tr.append(td4);
                tr.append(td5);
                tr.append(td6);
                tr.append(td7);
                tr.append(td8);
                body.append(tr);
        
            }

        },
        error : function(e) {
    	    alert("出错");
    	    alert(e.responseText);
    	}
    })
}

function saveCode(tableid, title) {
    var winname;
    try {
        if (navigator.userAgent.indexOf("MSIE") > 0)         //IE浏览器
        {
            var strHTML = $("#" + tableid).parent().html();
            //alert("IE浏览器");
            winname = window.open("ToExcel", "_blank", 'top=10000');
 
            winname.document.open('text/html', 'replace');
            winname.document.write("<style>");
            winname.document.write("table{border:solid 1px #000;text-align:center;border-collapse:collapse; border-spacing:0;}");
            winname.document.write("table td{border:solid 1px #000;text-align:center;}");
            winname.document.write("table th{border:solid 1px #000;text-align:center;}");
            winname.document.write("</style>");
            winname.document.write(strHTML);
            winname.document.execCommand('SaveAs', '', title + '.xls');
            document.execCommand("ClearAuthenticationCache");
            winname.close();
        }
        else if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0)       //Firefox 
        {
            //alert("Firefox"); 
            var str = getTblDataByFirefox(tableid, this);
            //支持中文
            var uri = 'data:text/csv;charset=utf-8,\ufeff' + encodeURIComponent(str);
            var downloadLink = document.createElement("a");
            downloadLink.href = uri;
            downloadLink.download = title + ".csv";
 
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
 
        }
        else       //Google Chrome
        {
            //alert("Google Chrome等浏览器");
            var str = getTblData(tableid, this);
          
            //支持中文
            var uri = 'data:text/csv;charset=utf-8,\ufeff' + encodeURIComponent(str);
 
            var downloadLink = document.createElement("a");
            downloadLink.href = uri;
            downloadLink.download = title + ".csv";
 
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
    } catch (e) {
        alert(e.Message);
        return false;
    }
    return false;
}
 
 
 
function getTblData(inTbl, inWindow) {
 
    var rows = 0;
    var tblDocument = document;
 
    tblDocument = eval(inWindow).document;
    var curTbl = tblDocument.getElementById(inTbl);
    var outStr = "";
    if (curTbl != null) {
        for (var j = 0; j < curTbl.rows.length; j++) {
            for (var i = 0; i < curTbl.rows[j].cells.length; i++) {
 
                if (i == 0 && rows > 0) {
                    outStr += ",";
                    rows -= 1;
                }
 
                outStr +=curTbl.rows[j].cells[i].innerText + ",";
                if (curTbl.rows[j].cells[i].colSpan > 1) {
                    for (var k = 0; k < curTbl.rows[j].cells[i].colSpan - 1; k++) {
                        outStr += ",";
                    }
                }
                if (i == 0) {
                    if (rows == 0 && curTbl.rows[j].cells[i].rowSpan > 1) {
                        rows = curTbl.rows[j].cells[i].rowSpan - 1;
                    }
                }
            }
            outStr += "\r\n";//换行
        }
    }
 
    else {
        outStr = null;
        alert(allPage.noData);
    }
    return outStr;
}

    </script>
	<!-- //Classie --><!-- //for toggle left push menu script -->

	<!--scrolling js-->
	<script src="{% static 'js/jquery.nicescroll.js' %}"></script>
	<script src="{% static 'js/scripts.js' %}"></script>
	<!--//scrolling js-->

	<!-- Bootstrap Core JavaScript -->
   <script src="{% static 'js/bootstrap.js' %}"> </script>
	<!-- //Bootstrap Core JavaScript -->
	</body>
</html>